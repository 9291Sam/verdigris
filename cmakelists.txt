cmake_minimum_required(VERSION 3.28)
project(verdigris)

include(FetchContent)

# # Default to C++ extensions being off. Clang's modules support have trouble
# # with extensions right now and it is not required for any other compiler
# set(CMAKE_CXX_EXTENSIONS OFF)

# if (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
#   include(gcc_modules.cmake)
# endif()
set(CMAKE_CXX_STANDARD 23)

# add_library(gfx)
# target_sources(gfx
#   PUBLIC
#   FILE_SET cxx_modules TYPE CXX_MODULES FILES
# )
# target_link_libraries(gfx PUBLIC util fmt::fmt concurrentqueue)

# add_library(util)
# target_sources(util
#   PUBLIC
#   FILE_SET cxx_modules TYPE CXX_MODULES FILES
# )
# target_link_libraries(util PUBLIC fmt::fmt concurrentqueue)


FetchContent_Declare(fmt
        GIT_REPOSITORY https://github.com/fmtlib/fmt.git
        GIT_TAG master
        GIT_SHALLOW TRUE
        )
FetchContent_MakeAvailable(fmt)

FetchContent_Declare(concurrentqueue
        GIT_REPOSITORY https://github.com/cameron314/concurrentqueue
        GIT_TAG master
        GIT_SHALLOW TRUE
        )
FetchContent_MakeAvailable(concurrentqueue)

add_executable(verdigris 
  src/main.cxx

  # src/util/misc.cxx
)
target_sources(verdigris
  PUBLIC
  FILE_SET cxx_modules TYPE CXX_MODULES FILES

  src/gfx/renderer.cxx

  src/util/log.cxx
  src/util/misc.ixx
  # src/util/misc.cxx
)
target_sources(verdigris PUBLIC
src/util/misc.cxx
)

target_link_libraries(verdigris PUBLIC fmt::fmt concurrentqueue)

